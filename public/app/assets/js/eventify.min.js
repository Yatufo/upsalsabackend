/*! eventify 2015-07-18 */
"use strict";function HomeController(a,b,c,d,e){b.CONFIG=e,b.categories||c.get(e.CATEGORIES_ENDPOINT).success(function(a){b.categories=a}),b.$on("$routeChangeSuccess",function(c,d,e){a.city=f(d.params.city),b.seo={title:"Up Salsa in "+a.city+" : Best places to dance Salsa, Bachata, Kizomba, etc.",metaDescription:"Find the best places and events to learn or dance in "+a.city+"any latin music like salsa, bachata, chacha, kizomba, etc."}}),d.init();var f=function(a){return a?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):void 0};$("#navbarCollapse").click(function(){$("#navbarCollapse").hasClass("in")&&$(".navbar-toggle").click()})}function AnalyticsService(a,b,c){var d={init:function(){a.$on("$viewContentLoaded",function(a){b.ga("send","pageview",{page:c.url()})})},track:function(a){ga("send","event",a.category,a.action,{page:a.url})}};return d}function MapsService(){var a,b,c,d=[],e="https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png",f="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",g={reset:function(){d&&(d.forEach(function(a){a.setMap(null)}),d=[],b=[])},init:function(c,d){a={},b={};var e={center:{lat:c?c.coordinates.latitude:45.56,lng:c?c.coordinates.longitude:-73.712},zoom:d?d:10};document.getElementById("map-canvas")&&(a=new google.maps.Map(document.getElementById("map-canvas"),e))},addLocation:function(c){if(c&&!b[c.id]){var e=new google.maps.Marker({position:new google.maps.LatLng(c.coordinates.latitude,c.coordinates.longitude),map:a,title:c.name});b[c.id]=e,d.push(e)}},highlightLocation:function(a){if(a){var d=b[a.id];d&&(c&&(c.setIcon(e),c.setZIndex(-1)),d.setIcon(f),d.setZIndex(100),c=d)}}};return g}function RatingService(a){var b=function(b){return[a.categories["class"],a.categories.party]},c={generateRatings:function(c){var d=[],e=[];return c.ratings.forEach(function(b){var f={category:a.categories[b.category],votes:b.votes,location:c};e.push(f.category),d.push(f)}),b().forEach(function(a){_.contains(e,a)||d.push({category:a,location:c})}),d}};return c}var eventify=angular.module("eventify",["ngRoute","ngResource","eventifyControllers","eventifyFilters","eventifyConfig","eventifyServices","eventifyResources"]);angular.module("eventifyControllers",["eventifyConfig","eventifyServices"]),angular.module("eventifyFilters",["eventifyConfig"]),angular.module("eventifyServices",["eventifyConfig"]),angular.module("eventifyResources",["ngResource"]),eventify.config(["$compileProvider","$locationProvider",function(a,b){a.debugInfoEnabled(!1),b.html5Mode(!0),b.hashPrefix("!"),a.aHrefSanitizationWhitelist(/^\s*(https?|whatsapp):/)}]),eventify.config(["$routeProvider",function(a){var b={city:function(){return"montreal"}};a.when("/:city/categories/:categories*/events/",{templateUrl:"views/events.html",controller:"EventsController"}).when("/:city/events/:eventId",{templateUrl:"views/events-details.html",controller:"EventDetailsController"}).when("/:city/locations",{templateUrl:"views/locations.html",controller:"LocationsController"}).when("/:city/locations/:locationId",{templateUrl:"views/locations-details.html",controller:"LocationDetailsController"}).when("/:city",{templateUrl:"views/home.html",controller:"HomeController",resolve:b}).otherwise({redirectTo:"/montreal/locations"})}]),angular.module("eventify").directive("eventcard",function(){return{restrict:"E",scope:{event:"=",city:"="},templateUrl:"views/components/event-card.html"}}),angular.module("eventify").directive("locationcard",function(){return{restrict:"E",scope:{location:"=",city:"="},templateUrl:"views/components/location-card.html"}}),angular.module("eventify").directive("rating",function(){return{restrict:"E",scope:{ratings:"="},controller:["$scope","Rating",function(a,b){var c=function(a,b){a.votes=a.votes||[];var c=a.vote;c&&a.votes[c]&&(a.votes[c]=a.votes[c]-1||void 0),a.votes[b]=a.votes[b]+1||1},d=function(a){var c=new b({id:a.id,location:a.location.id,category:a.category.id,vote:a.vote});c.id?b.update(c):c.$save(function(b,c){a.id=b.id})};a.resetUnvotedRating=function(){a.current=void 0,a.ratings&&a.ratings.slice().reverse().forEach(function(b){b.votes||(a.current=b)})},a.rate=function(b,e){return b.vote&&b.vote===e?!1:(c(b,e),b.vote=e,b.isUp="up"===b.vote,b.isDown="down"===b.vote,d(b),void a.resetUnvotedRating())},a.resetUnvotedRating()}],templateUrl:"views/components/rating.html"}}),angular.module("eventify").directive("sharesocial",["$window","AnalyticsService",function(a,b){return{restrict:"E",scope:{message:"=",url:"="},controller:["$scope",function(c){c.facebookUrl="https://www.facebook.com/sharer/sharer.php?&u="+encodeURIComponent(c.url),c.twitterUrl="https://twitter.com/intent/tweet?text="+c.message+"&url="+encodeURIComponent(c.url),c.whatsappUrl="whatsapp://send?text="+c.message+" "+c.url,c.share=function(d){a.open(d,"sharesocial","height=450, width=550, top="+(a.innerHeight/2-275)+", left="+(a.innerWidth/2-225)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0"),b.track({category:"social",action:"share",url:c.url})}}],templateUrl:"views/components/share-social.html"}}]);var config_module=angular.module("eventifyConfig",[]).constant("CONFIG",{CATEGORIES_REVIEWS_ORDER:["class","party"],EVENTS_ENDPOINT:"/api/events",CATEGORIES_ENDPOINT:"/api/categories",LOCATIONS_ENDPOINT:"/api/locations",TODAY:new Date,ONE_DAY_MILIS:864e5,WEEKEND_DAYS:[5,6,0],WEEK_DAYS:[1,2,3,4,5,6,0],DEFAULT_CATEGORIES:{musictype:"salsa"}});angular.module("eventifyControllers").controller("CategoriesController",["$scope","$http","$routeParams","CONFIG","diffusionService",function(a,b,c,d,e){a.isCollapsed=!1,a.selectedCategories={},a.root={categories:[]},a.reloadCategories=!1,a.selectedEventtype={},a.categories||b.get(d.CATEGORIES_ENDPOINT).success(function(b){a.categories=b,a.root=b.root,f()});var f=function(){a.selectedCategories={};for(var b in d.DEFAULT_CATEGORIES)h(b,d.DEFAULT_CATEGORIES[b]);if(c.categories){var f=c.categories.replace("*","").split("/");f.forEach(function(a){h(g(a),a)})}e.changeCategories(a.selectedCategories)},g=function(b){if(a.categories){var c=a.categories[b];if(c)return c.parent}return null};a.changeSelectCategory=function(b,c){h(b,c),e.changeCategories(a.selectedCategories)};var h=function(b,c){a.selectedCategories[b]=a.selectedCategories[b]!==c?c:null,i(b,c),"eventtype"==b&&(a.selectedEventtype=a.categories[a.selectedCategories[b]])},i=function(b,c){if(c){var d=a.categories[c],e=a.root.categories.indexOf(d),f=a.selectedCategories[b]===c,g=e>=0;f&&!g?a.root.categories.push(d):(a.root.categories.splice(e,1),h(c,null))}};e.onChangeEvents(a,function(b){a.eventsCategories=b.eventsCategories?b.eventsCategories:[],j()});var j=function(){a.root.categories.forEach(function(b){var c=0;a.categories[b.id].categories.forEach(function(a){l(a),a.visible&&c++}),b.visible=k(b,c)})},k=function(b,c){var d="eventtype"===b.id,e=angular.isString(a.selectedCategories[b.id]),f=c>=1;return(e||f)&&!d},l=function(b){b.selected=a.selectedCategories[b.parent]===b.id;var c="happenson"===b.parent,d=-1!=a.eventsCategories.indexOf(b.id),e=!angular.isString(a.selectedCategories[b.parent]);b.visible=(c||d)&&(e||b.selected),b.disabled=!(c||d)}}]),angular.module("eventifyControllers").controller("EventDetailsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.event={},b.get(d.EVENTS_ENDPOINT+"/"+c.eventId).success(function(b,c,d,f){a.event=b,a.event&&(e.init(a.event.location,14),e.addLocation(a.event.location))}).error(function(a,b,c,d){console.log("Something went wrong")}),window.scrollTo(0,0)}]),angular.module("eventifyControllers").controller("EventsController",["$scope","$http","$filter","$routeParams","CONFIG","diffusionService","MapsService",function(a,b,c,d,e,f,g){a.localTime=e.TODAY,a.selectedCategories={},a.events=[],a.loading=!0,d.testDate&&(a.localTime=new Date(d.testDate)),f.onChangeCategories(a,function(b){a.selectedCategories=b.selected,a.loading=!0,h()});var h=function(){i(j(),null,function(b){a.events=b.events,k(a.events),f.changeEvents(b.eventsCategories)})},i=function(c,d,f){var g={params:{categories:c.join(",")}};b.get(e.EVENTS_ENDPOINT,g).success(function(b){f(b),a.loading=!1})},j=function(){var b=[];for(var c in a.selectedCategories)a.selectedCategories[c]&&b.push(a.selectedCategories[c]);return b},k=function(a){g.reset(),angular.isArray(a)&&a.forEach(function(a){g.addLocation(a.location)})};a.highlightLocation=function(a){g.highlightLocation(a)},g.init()}]),angular.module("eventifyControllers").controller("HomeController",["$scope","$rootScope","$http","AnalyticsService","CONFIG",HomeController]),angular.module("eventifyControllers").controller("LocationDetailsController",["$rootScope","$scope","$routeParams","Location","MapsService","RatingService",function(a,b,c,d,e,f){b.location={},d.get({locationId:c.locationId},function(a){e.init(a,14),e.addLocation(a),a.ratings=f.generateRatings(a),b.location=a}),window.scrollTo(0,0)}]),angular.module("eventifyControllers").controller("LocationsController",["$scope","Location","MapsService","RatingService",function(a,b,c,d){a.locations=[],b.query({},function(b){a.locations=b,c.init(),a.locations.forEach(function(a){c.addLocation(a),a.ratings=d.generateRatings(a)})}),a.highlightLocation=function(a){c.highlightLocation(a)},window.scrollTo(0,0)}]),$(window).scroll(function(){$(this).scrollTop()>135?$("#fixedColunm").addClass("fixed"):$("#fixedColunm").removeClass("fixed")});var scrolltotop={setting:{startline:100,scrollto:0,scrollduration:1e3,fadeduration:[500,100]},controlHTML:"",controlattrs:{offsetx:5,offsety:5},anchorkeyword:"#top",state:{isvisible:!1,shouldvisible:!1},scrollup:function(){this.cssfixedsupport||this.$control.css({opacity:0});var a=isNaN(this.setting.scrollto)?this.setting.scrollto:parseInt(this.setting.scrollto);a="string"==typeof a&&1==jQuery("#"+a).length?jQuery("#"+a).offset().top:0,this.$body.animate({scrollTop:a},this.setting.scrollduration)},keepfixed:function(){var a=jQuery(window),b=a.scrollLeft()+a.width()-this.$control.width()-this.controlattrs.offsetx,c=a.scrollTop()+a.height()-this.$control.height()-this.controlattrs.offsety;this.$control.css({left:b+"px",top:c+"px"})},togglecontrol:function(){var a=jQuery(window).scrollTop();this.cssfixedsupport||this.keepfixed(),this.state.shouldvisible=a>=this.setting.startline?!0:!1,this.state.shouldvisible&&!this.state.isvisible?(this.$control.stop().animate({opacity:1},this.setting.fadeduration[0]),this.state.isvisible=!0):0==this.state.shouldvisible&&this.state.isvisible&&(this.$control.stop().animate({opacity:0},this.setting.fadeduration[1]),this.state.isvisible=!1)},init:function(){jQuery(document).ready(function(a){var b=scrolltotop,c=document.all;b.cssfixedsupport=!c||c&&"CSS1Compat"==document.compatMode&&window.XMLHttpRequest,b.$body=a(window.opera?"CSS1Compat"==document.compatMode?"html":"body":"html,body"),b.$control=a('<div id="topcontrol">'+b.controlHTML+"</div>").css({position:b.cssfixedsupport?"fixed":"absolute",bottom:b.controlattrs.offsety,right:b.controlattrs.offsetx,opacity:0,cursor:"pointer"}).attr({title:"Scroll Back to Top"}).click(function(){return b.scrollup(),!1}).appendTo("body"),document.all&&!window.XMLHttpRequest&&""!=b.$control.text()&&b.$control.css({width:b.$control.width()}),b.togglecontrol(),a('a[href="'+b.anchorkeyword+'"]').click(function(){return b.scrollup(),!1}),a(window).bind("scroll resize",function(a){b.togglecontrol()})})}};scrolltotop.init(),angular.module("eventifyFilters").filter("fullUrl",["$location",function(a){return function(b){return a.absUrl().replace(a.path(),b)}}]),angular.module("eventifyResources").factory("Location",["$resource",function(a){return a("/api/locations/:locationId",{locationId:"@id"},{update:{method:"PUT"}})}]),angular.module("eventifyResources").factory("Rating",["$resource",function(a){return a("/api/ratings/:ratingId",{ratingId:"@id"},{update:{method:"PUT"}})}]),angular.module("eventifyServices").factory("AnalyticsService",["$rootScope","$window","$location",AnalyticsService]),angular.module("eventifyServices").factory("diffusionService",["$rootScope",function(a){var b="changeCategories",c="changeEvents",d=function(c){a.$broadcast(b,{selected:c})},e=function(a,c){a.$on(b,function(a,b){c(b)})},f=function(b){a.$broadcast(c,{eventsCategories:b})},g=function(a,b){a.$on(c,function(a,c){b(c)})};return{changeCategories:d,onChangeCategories:e,changeEvents:f,onChangeEvents:g}}]),angular.module("eventifyServices").factory("MapsService",MapsService),angular.module("eventifyServices").factory("RatingService",["$rootScope",RatingService]),window.Set=function(){this.content={}},Set.prototype.content=function(){return this.content},Set.prototype.add=function(a){this.content[a]=!0},Set.prototype.remove=function(a){delete this.content[a]},Set.prototype.contains=function(a){return a in this.content},Set.prototype.asArray=function(){var a=[];for(var b in this.content)a.push(b);return a};