/*! eventify 2015-07-03 */
"use strict";function HomeController(a,b,c,d){b.CONFIG=d,b.$on("$routeChangeSuccess",function(c,d,f){a.city=e(d.params.city),b.seo={title:"Up Salsa in "+a.city+" : Best places to dance Salsa, Bachata, Kizomba, etc.",metaDescription:"Find the best places and events to learn or dance in "+a.city+"any latin music like salsa, bachata, chacha, kizomba, etc."}}),c.init();var e=function(a){return a?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):void 0};$("#navbarCollapse").click(function(){$("#navbarCollapse").hasClass("in")&&$(".navbar-toggle").click()})}function AnalyticsService(a,b,c){var d={init:function(){a.$on("$viewContentLoaded",function(a){b.ga("send","pageview",{page:c.url()})})},track:function(a){ga("send","event",a.category,a.action,{page:a.url})}};return d}function MapsService(){var a,b,c,d=[],e="https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png",f="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",g={reset:function(){d&&(d.forEach(function(a){a.setMap(null)}),d=[],b=[])},init:function(c,d){a={},b={};var e={center:{lat:c?c.coordinates.latitude:45.56,lng:c?c.coordinates.longitude:-73.712},zoom:d?d:10};document.getElementById("map-canvas")&&(a=new google.maps.Map(document.getElementById("map-canvas"),e))},addLocation:function(c){if(c&&!b[c.id]){var e=new google.maps.Marker({position:new google.maps.LatLng(c.coordinates.latitude,c.coordinates.longitude),map:a,title:c.name});b[c.id]=e,d.push(e)}},highlightLocation:function(a){if(a){var d=b[a.id];d&&(c&&(c.setIcon(e),c.setZIndex(-1)),d.setIcon(f),d.setZIndex(100),c=d)}}};return g}var eventify=angular.module("eventify",["ngRoute","eventifyControllers","eventifyFilters","eventifyConfig","eventifyServices"]);angular.module("eventifyControllers",["eventifyConfig","eventifyServices"]),angular.module("eventifyFilters",["eventifyConfig"]),angular.module("eventifyServices",["eventifyConfig"]),eventify.config(["$compileProvider","$locationProvider",function(a,b){a.debugInfoEnabled(!1),b.html5Mode(!0),b.hashPrefix("!"),a.aHrefSanitizationWhitelist(/^\s*(https?|whatsapp):/)}]),eventify.config(["$routeProvider",function(a){var b={city:function(){return"montreal"}};a.when("/:city/categories/:categories*/events/",{templateUrl:"views/events.html",controller:"EventsController"}).when("/:city/events/:eventId",{templateUrl:"views/events-details.html",controller:"EventDetailsController"}).when("/:city/locations",{templateUrl:"views/locations.html",controller:"LocationsController"}).when("/:city/locations/:locationId",{templateUrl:"views/locations-details.html",controller:"LocationDetailsController"}).when("/:city",{templateUrl:"views/home.html",controller:"HomeController",resolve:b}).otherwise({redirectTo:"/montreal/locations"})}]),angular.module("eventify").directive("eventcard",function(){return{restrict:"E",scope:{event:"=",city:"="},templateUrl:"views/components/event-card.html"}}),angular.module("eventify").directive("locationcard",function(){return{restrict:"E",scope:{location:"=",city:"="},templateUrl:"views/components/location-card.html"}}),angular.module("eventify").directive("rating",function(){return{restrict:"E",scope:{location:"="},templateUrl:"views/components/rating.html"}}),angular.module("eventify").directive("sharesocial",["$window","AnalyticsService",function(a,b){return{restrict:"E",scope:{message:"=",url:"="},controller:["$scope",function(c){c.facebookUrl="https://www.facebook.com/sharer/sharer.php?&u="+encodeURIComponent(c.url),c.twitterUrl="https://twitter.com/intent/tweet?text="+c.message+"&url="+encodeURIComponent(c.url),c.whatsappUrl="whatsapp://send?text="+c.message+" "+c.url,c.share=function(d,e){e.preventDefault(),e.stopPropagation(),a.open(d,"sharesocial","height=450, width=550, top="+(a.innerHeight/2-275)+", left="+(a.innerWidth/2-225)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0"),b.track({category:"social",action:"share",url:c.url})}}],templateUrl:"views/components/share-social.html"}}]);var config_module=angular.module("eventifyConfig",[]).constant("CONFIG",{EVENTS_ENDPOINT:"/api/events",CATEGORIES_ENDPOINT:"/api/categories",LOCATIONS_ENDPOINT:"/api/locations",TODAY:new Date,ONE_DAY_MILIS:864e5,WEEKEND_DAYS:[5,6,0],WEEK_DAYS:[1,2,3,4,5,6,0],DEFAULT_CATEGORIES:{musictype:"salsa"}});angular.module("eventifyControllers").controller("CategoriesController",["$scope","$http","$routeParams","CONFIG","diffusionService",function(a,b,c,d,e){a.isCollapsed=!1,a.selectedCategories={},a.root={categories:[]},a.reloadCategories=!1,a.selectedEventtype={},a.categories||b.get(d.CATEGORIES_ENDPOINT).success(function(b){a.categories=b,a.root=b.root,f()});var f=function(){a.selectedCategories={};for(var b in d.DEFAULT_CATEGORIES)h(b,d.DEFAULT_CATEGORIES[b]);if(c.categories){var f=c.categories.replace("*","").split("/");f.forEach(function(a){h(g(a),a)})}e.changeCategories(a.selectedCategories)},g=function(b){if(a.categories){var c=a.categories[b];if(c)return c.parent}return null};a.changeSelectCategory=function(b,c){h(b,c),e.changeCategories(a.selectedCategories)};var h=function(b,c){a.selectedCategories[b]=a.selectedCategories[b]!==c?c:null,i(b,c),"eventtype"==b&&(a.selectedEventtype=a.categories[a.selectedCategories[b]])},i=function(b,c){if(c){var d=a.categories[c],e=a.root.categories.indexOf(d),f=a.selectedCategories[b]===c,g=e>=0;f&&!g?a.root.categories.push(d):(a.root.categories.splice(e,1),h(c,null))}};e.onChangeEvents(a,function(b){a.eventsCategories=b.eventsCategories?b.eventsCategories:[],j()});var j=function(){a.root.categories.forEach(function(b){var c=0;a.categories[b.id].categories.forEach(function(a){l(a),a.visible&&c++}),b.visible=k(b,c)})},k=function(b,c){var d="eventtype"===b.id,e=angular.isString(a.selectedCategories[b.id]),f=c>=1;return(e||f)&&!d},l=function(b){b.selected=a.selectedCategories[b.parent]===b.id;var c="happenson"===b.parent,d=-1!=a.eventsCategories.indexOf(b.id),e=!angular.isString(a.selectedCategories[b.parent]);b.visible=(c||d)&&(e||b.selected),b.disabled=!(c||d)}}]),angular.module("eventifyControllers").controller("EventDetailsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.event={},b.get(d.EVENTS_ENDPOINT+"/"+c.eventId).success(function(b,c,d,f){a.event=b,a.event&&(e.init(a.event.location,14),e.addLocation(a.event.location))}).error(function(a,b,c,d){console.log("Something went wrong")}),window.scrollTo(0,0)}]),angular.module("eventifyControllers").controller("EventsController",["$scope","$http","$filter","$routeParams","CONFIG","diffusionService","MapsService",function(a,b,c,d,e,f,g){a.localTime=e.TODAY,a.selectedCategories={},a.events=[],a.loading=!0,d.testDate&&(a.localTime=new Date(d.testDate)),f.onChangeCategories(a,function(b){a.selectedCategories=b.selected,a.loading=!0,h()});var h=function(){i(j(),null,function(b){a.events=b.events,k(a.events),f.changeEvents(b.eventsCategories)})},i=function(c,d,f){var g={params:{categories:c.join(",")}};b.get(e.EVENTS_ENDPOINT,g).success(function(b){f(b),a.loading=!1})},j=function(){var b=[];for(var c in a.selectedCategories)a.selectedCategories[c]&&b.push(a.selectedCategories[c]);return b},k=function(a){g.reset(),angular.isArray(a)&&a.forEach(function(a){g.addLocation(a.location)})};a.highlightLocation=function(a){g.highlightLocation(a)},g.init()}]),angular.module("eventifyControllers").controller("HomeController",["$scope","$rootScope","AnalyticsService","CONFIG",HomeController]),angular.module("eventifyControllers").controller("LocationDetailsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.location={},b.get(d.LOCATIONS_ENDPOINT+"/"+c.locationId).success(function(b,c,d,f){a.location=b,a.location&&(e.init(a.location,14),e.addLocation(a.location))}).error(function(a,b,c,d){console.log("Something went wrong")}),window.scrollTo(0,0)}]),angular.module("eventifyControllers").controller("LocationsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.locations=[],b.get(d.LOCATIONS_ENDPOINT).success(function(b,c,d,f){a.locations=b,a.locations&&(e.init(),a.locations.forEach(function(a){e.addLocation(a)}))}).error(function(a,b,c,d){console.log("Something went wrong with the locations")}),a.highlightLocation=function(a){e.highlightLocation(a)},window.scrollTo(0,0)}]),angular.module("eventifyFilters").filter("fullUrl",["$location",function(a){return function(b){return a.absUrl().replace(a.path(),b)}}]),angular.module("eventifyServices").factory("AnalyticsService",["$rootScope","$window","$location",AnalyticsService]),angular.module("eventifyServices").factory("MapsService",MapsService),window.Set=function(){this.content={}},Set.prototype.content=function(){return this.content},Set.prototype.add=function(a){this.content[a]=!0},Set.prototype.remove=function(a){delete this.content[a]},Set.prototype.contains=function(a){return a in this.content},Set.prototype.asArray=function(){var a=[];for(var b in this.content)a.push(b);return a},angular.module("eventifyServices").factory("diffusionService",["$rootScope",function(a){var b="changeCategories",c="changeEvents",d=function(c){a.$broadcast(b,{selected:c})},e=function(a,c){a.$on(b,function(a,b){c(b)})},f=function(b){a.$broadcast(c,{eventsCategories:b})},g=function(a,b){a.$on(c,function(a,c){b(c)})};return{changeCategories:d,onChangeCategories:e,changeEvents:f,onChangeEvents:g}}]);