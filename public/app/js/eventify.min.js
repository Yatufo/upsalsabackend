/*! eventify 2015-02-28 */
"use strict";function MapsService(){var a,b,c=[],d={reset:function(){c&&(c.forEach(function(a){a.setMap(null)}),c=[],b=[])},init:function(c,d){a={},b={};var e={center:{lat:c?c.coordinates.latitude:45.56,lng:c?c.coordinates.longitude:-73.712},zoom:d?d:10};document.getElementById("map-canvas")&&(a=new google.maps.Map(document.getElementById("map-canvas"),e))},addLocation:function(d){if(d&&!b[d.id]){b[d.id]=!0;var e=new google.maps.Marker({position:new google.maps.LatLng(d.coordinates.latitude,d.coordinates.longitude),map:a,title:d.name});c.push(e)}}};return d}var myApp=angular.module("myApp",["ngRoute","myAppControllers","myAppFilters","myAppConfig","myAppServices"]);angular.module("myAppControllers",["myAppConfig","myAppServices"]),angular.module("myAppFilters",["myAppConfig"]),angular.module("myAppServices",["myAppConfig"]),myApp.config(["$compileProvider",function(a){a.debugInfoEnabled(!1)}]),myApp.config(["$routeProvider",function(a){a.when("/:city/categories/:eventType/events/",{templateUrl:"views/events.html",controller:"EventsController"}).when("/:city/events/:eventId",{templateUrl:"views/events-details.html",controller:"EventDetailsController"}).when("/:city/locations",{templateUrl:"views/locations.html",controller:"LocationsController"}).when("/:city/locations/:locationId",{templateUrl:"views/locations-details.html",controller:"LocationDetailsController"}).when("/:city",{templateUrl:"views/home.html",controller:"HomeController"}).otherwise({redirectTo:"/montreal"})}]);var config_module=angular.module("myAppConfig",[]).constant("CONFIG",{EVENTS_ENDPOINT:"/api/events",CATEGORIES_ENDPOINT:"/api/categories",LOCATIONS_ENDPOINT:"/api/locations",TODAY:new Date,ONE_DAY_MILIS:864e5,WEEKEND_DAYS:[5,6,0],WEEK_DAYS:[1,2,3,4,5,6,0],DEFAULT_CATEGORIES:{musictype:"salsa"}});angular.module("myAppControllers").controller("CategoriesController",["$scope","$http","$routeParams","CONFIG","diffusionService",function(a,b,c,d,e){a.isCollapsed=!1,a.selectedCategories={},a.root={categories:[]},a.reloadCategories=!1,a.categories||b.get(d.CATEGORIES_ENDPOINT).success(function(b){a.categories=b,a.root=b.root,f()});var f=function(){a.selectedCategories={};for(var b in d.DEFAULT_CATEGORIES)g(b,d.DEFAULT_CATEGORIES[b]);c.eventType&&a.changeSelectCategory("eventtype",c.eventType)};a.changeSelectCategory=function(b,c){g(b,c),e.changeCategories(a.selectedCategories)};var g=function(b,c){a.selectedCategories[b]=a.selectedCategories[b]!==c?c:null,h(b,c)},h=function(b,c){if(c){var d=a.categories[c],e=a.root.categories.indexOf(d),f=a.selectedCategories[b]===c,h=e>=0;f&&!h?a.root.categories.push(d):(a.root.categories.splice(e,1),g(c,null))}};e.onChangeEvents(a,function(b){a.eventsCategories=b.eventsCategories,i()});var i=function(){a.root.categories.forEach(function(b){var c=0;a.categories[b.id].categories.forEach(function(a){k(a),a.visible&&c++}),b.visible=j(b,c)})},j=function(b,c){var d="eventtype"===b.id,e=angular.isString(a.selectedCategories[b.id]),f=c>=1;return(e||f)&&!d},k=function(b){b.selected=a.selectedCategories[b.parent]===b.id;var c="happenson"===b.parent,d=-1!=a.eventsCategories.indexOf(b.id),e=!angular.isString(a.selectedCategories[b.parent]);b.visible=(c||d)&&(e||b.selected),b.disabled=!(c||d)}}]),angular.module("myAppControllers").controller("EventDetailsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.event={},b.get(d.EVENTS_ENDPOINT+"/"+c.eventId).success(function(b){a.event=b,a.event&&(e.init(a.event.location,14),e.addLocation(a.event.location))}).error(function(){console.log("Something went wrong")}),window.scrollTo(0,0)}]),angular.module("myAppControllers").controller("EventsController",["$scope","$http","$filter","$routeParams","CONFIG","diffusionService","MapsService",function(a,b,c,d,e,f,g){a.localTime=e.TODAY,a.eventsCategories=new Set,a.selectedCategories={},a.events=[],d.testDate&&(a.localTime=new Date(d.testDate)),f.onChangeCategories(a,function(b){a.selectedCategories=b.selected,h()});var h=function(){i(j(),null,function(b){a.events=b.events,a.events&&(k(),l(),f.changeEvents(a.eventsCategories.asArray()))})},i=function(a,c,d){var f={params:{categories:a.join(",")}};b.get(e.EVENTS_ENDPOINT,f).success(function(a){d(a)})},j=function(){var b=[];for(var c in a.selectedCategories)a.selectedCategories[c]&&b.push(a.selectedCategories[c]);return b},k=function(){a.eventsCategories.content={},angular.isArray(a.events)&&a.events.forEach(function(b){angular.isArray(b.categories)&&b.categories.forEach(function(b){a.eventsCategories.add(b)})})},l=function(){g.reset(),angular.isArray(a.events)&&a.events.forEach(function(a){g.addLocation(a.location)})};g.init()}]),angular.module("myAppControllers").controller("HomeController",["$scope","$rootScope","$routeParams","$http","CONFIG",function(a,b,c,d,e){b.CONFIG=e,b.$on("$routeChangeSuccess",function(b,c){a.city=f(c.params.city),a.eventType=c.params.eventType});var f=function(a){return a?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):void 0}}]),angular.module("myAppControllers").controller("LocationDetailsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.location={},b.get(d.LOCATIONS_ENDPOINT+"/"+c.locationId).success(function(b){a.location=b,a.location&&(e.init(a.location,14),e.addLocation(a.location))}).error(function(){console.log("Something went wrong")}),window.scrollTo(0,0)}]),angular.module("myAppControllers").controller("LocationsController",["$scope","$http","$routeParams","CONFIG","MapsService",function(a,b,c,d,e){a.locations=[],b.get(d.LOCATIONS_ENDPOINT).success(function(b){a.locations=b,a.locations&&(e.init(),a.locations.forEach(function(a){e.addLocation(a)}))}).error(function(){console.log("Something went wrong with the locations")}),window.scrollTo(0,0)}]),angular.module("myApp").directive("eventcard",function(){return{restrict:"E",scope:{event:"=",city:"="},templateUrl:"views/components/event-card.html"}}),angular.module("myApp").directive("locationcard",function(){return{restrict:"E",scope:{location:"=",city:"="},templateUrl:"views/components/location-card.html"}}),angular.module("myAppFilters").filter("categories",["CONFIG",function(){return function(a,b){if(!angular.isArray(a))return!1;var c=a.slice(0);for(var d in b){var e=b[d];if("happenson"!==d&&angular.isDefined(e)&&null!==e)for(var f=c.length-1;f>=0;f--){var g=-1;angular.isArray(c[f].categories)&&(g=c[f].categories.indexOf(e)),-1==g&&c.splice(f,1)}}return c}}]),angular.module("myAppFilters").filter("happensOn",["CONFIG",function(a){return function(b,c,d){if(!angular.isArray(b))return!1;if(!angular.isString(c))return b;angular.isUndefined(d)&&(console.log("Using the browsers local time"),d=new Date);for(var e=[],f=0;f<b.length;f++){var g=b[f];if(angular.isUndefined(g.start)||angular.isUndefined(g.start.dateTime))console.log("Event without a start date - Ommiting");else{var h=new Date(g.start.dateTime),i=h-d,j=!1;switch(c){case"today":var k=!(angular.isUndefined(g.end)||angular.isUndefined(g.end.dateTime))&&0>i&&new Date(g.end.dateTime)-d>0;j=i>=0&&i<a.ONE_DAY_MILIS||k;break;case"tomorrow":j=i>=a.ONE_DAY_MILIS&&i<2*a.ONE_DAY_MILIS;break;case"weekend":j=i>=0&&i<7*a.ONE_DAY_MILIS&&a.WEEKEND_DAYS.indexOf(h.getDay())>-1;break;case"week":j=i>=0&&i<7*a.ONE_DAY_MILIS&&a.WEEK_DAYS.indexOf(h.getDay())>-1;break;default:j=!1}j&&e.push(g)}}return e}}]),angular.module("myAppServices").factory("diffusionService",["$rootScope",function(a){var b="changeCategories",c="changeEvents",d=function(c){a.$broadcast(b,{selected:c})},e=function(a,c){a.$on(b,function(a,b){c(b)})},f=function(b){a.$broadcast(c,{eventsCategories:b})},g=function(a,b){a.$on(c,function(a,c){b(c)})};return{changeCategories:d,onChangeCategories:e,changeEvents:f,onChangeEvents:g}}]),angular.module("myAppServices").factory("MapsService",MapsService),window.Set=function(){this.content={}},Set.prototype.content=function(){return this.content},Set.prototype.add=function(a){this.content[a]=!0},Set.prototype.remove=function(a){delete this.content[a]},Set.prototype.contains=function(a){return a in this.content},Set.prototype.asArray=function(){var a=[];for(var b in this.content)a.push(b);return a};