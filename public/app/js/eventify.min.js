/*! eventify 2014-11-17 */
"use strict";var myApp=angular.module("myApp",["ngRoute","myAppControllers","myAppFilters","myAppConfig","myAppServices","ui.bootstrap"]);angular.module("myAppControllers",["myAppConfig","myAppServices"]),angular.module("myAppFilters",["myAppConfig"]),angular.module("myAppServices",["myAppConfig"]),myApp.config(["$compileProvider",function(a){a.debugInfoEnabled(!1)}]),myApp.config(["$routeProvider",function(a){a.when("/city/:city/events",{templateUrl:"views/events.html",controller:"EventsCtrl"}).otherwise({redirectTo:"/city/montreal/events"})}]);var config_module=angular.module("myAppConfig",[]).constant("CONFIG",{EVENTS_ENDPOINT:"/api/events",CATEGORIES_ENDPOINT:"/api/categories",TODAY:new Date,ONE_DAY_MILIS:864e5,WEEKEND_DAYS:[5,6,0],WEEK_DAYS:[1,2,3,4,5,6,0],DEFAULT_CATEGORIES:{}});angular.module("myAppControllers").controller("CategoriesCtrl",["$scope","$http","CONFIG","diffusionService",function(a,b,c,d){a.isCollapsed=!1,a.selectedCategories={},a.categories={},a.rootCategories=[],a.$watch("selectedCategories",function(){d.changeCategories(a.selectedCategories)},!0),b.get(c.CATEGORIES_ENDPOINT).success(function(b){a.categories=b,a.rootCategories=b.root,e()}),a.restoreFilters=function(){a.selectedCategories={},e()};var e=function(){for(var b in c.DEFAULT_CATEGORIES)a.selectedCategories[b]=c.DEFAULT_CATEGORIES[b];d.changeCategories(a.selectedCategories)};a.isGroupVisible=function(b){return angular.isUndefined(b.parent)||a.selectedCategories[b.parent]===b.id},d.onChangeEvents(a,function(b){a.eventsCategories=b.eventsCategories,f()});var f=function(){a.rootCategories.forEach(function(b){var c=0;a.categories[b.id].forEach(function(a){a.visible=h(a),a.visible&&c++}),b.visible=g(b,c)})},g=function(b,c){var d=angular.isString(a.selectedCategories[b.id]),e=c>1;return d||e},h=function(b){var c="happenson"===b.parent,d=-1!=a.eventsCategories.indexOf(b.id),e=a.selectedCategories[b.parent]===b.id,f=!angular.isString(a.selectedCategories[b.parent]);return!e||c||d||(a.selectedCategories[b.parent]=null),(c||d)&&(f||e)}}]),angular.module("myAppControllers").controller("EventsCtrl",["$scope","$http","$filter","$routeParams","CONFIG","diffusionService",function(a,b,c,d,e,f){function g(){this.content={}}a.localTime=e.TODAY,a.eventsCategories=new g,a.filteredEvents=[],d.testDate&&(a.localTime=new Date(d.testDate)),a.$watch("eventsCategories.content",function(){f.changeEvents(a.eventsCategories.asArray())},!0),b.get(e.EVENTS_ENDPOINT).success(function(b){a.events=b,a.filteredEvents=b,h()}),f.onChangeCategories(a,function(b){a.filteredEvents=c("happensOn")(a.events,b.selected.happenson,a.localTime),a.filteredEvents=c("categories")(a.filteredEvents,b.selected),h()});var h=function(){a.eventsCategories.content={};for(var b=a.filteredEvents.length-1;b>=0;b--){var c=a.filteredEvents[b].categories;if(angular.isArray(c))for(var d=c.length-1;d>=0;d--)a.eventsCategories.add(c[d])}};g.prototype.content=function(){return this.content},g.prototype.add=function(a){this.content[a]=!0},g.prototype.remove=function(a){delete this.content[a]},g.prototype.contains=function(a){return a in this.content},g.prototype.asArray=function(){var a=[];for(var b in this.content)a.push(b);return a}}]),angular.module("myAppControllers").controller("HomeCtrl",["$scope","$rootScope","$routeParams","$http","CONFIG",function(a,b,c,d,e){b.CONFIG=e}]),angular.module("myAppFilters").filter("categories",["CONFIG",function(){return function(a,b){if(!angular.isArray(a))return!1;var c=a.slice(0);for(var d in b){var e=b[d];if("happenson"!==d&&angular.isDefined(e)&&null!==e)for(var f=c.length-1;f>=0;f--){var g=-1;angular.isArray(c[f].categories)&&(g=c[f].categories.indexOf(e)),-1==g&&c.splice(f,1)}}return c}}]),angular.module("myAppFilters").filter("happensOn",["CONFIG",function(a){return function(b,c,d){if(!angular.isArray(b))return!1;if(!angular.isString(c))return b;angular.isUndefined(d)&&(console.log("Using the browsers local time"),d=new Date);for(var e=[],f=0;f<b.length;f++){var g=b[f];if(angular.isUndefined(g.start)||angular.isUndefined(g.start.dateTime))console.log("Event without a start date - Ommiting");else{var h=new Date(g.start.dateTime),i=h-d,j=!1;switch(c){case"today":var k=!(angular.isUndefined(g.end)||angular.isUndefined(g.end.dateTime))&&0>i&&new Date(g.end.dateTime)-d>0;j=i>=0&&i<a.ONE_DAY_MILIS||k;break;case"tomorrow":j=i>=a.ONE_DAY_MILIS&&i<2*a.ONE_DAY_MILIS;break;case"weekend":j=i>=0&&i<7*a.ONE_DAY_MILIS&&a.WEEKEND_DAYS.indexOf(h.getDay())>-1;break;case"week":j=i>=0&&i<7*a.ONE_DAY_MILIS&&a.WEEK_DAYS.indexOf(h.getDay())>-1;break;default:j=!1}j&&e.push(g)}}return e}}]),angular.module("myAppServices").factory("diffusionService",["$rootScope",function(a){var b="changeCategories",c="changeEvents",d=function(c){a.$broadcast(b,{selected:c})},e=function(a,c){a.$on(b,function(a,b){c(b)})},f=function(b){a.$broadcast(c,{eventsCategories:b})},g=function(a,b){a.$on(c,function(a,c){b(c)})};return{changeCategories:d,onChangeCategories:e,changeEvents:f,onChangeEvents:g}}]);